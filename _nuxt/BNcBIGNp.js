import{_ as j,T as J,r as x,D as V,o as K,v as u,H as e,A as n,y as o,G as P,J as f,a1 as Q,z as p,B as d,a2 as X,K as _,I as Y,a3 as Z,x as c,L as w,M as S,N as D,a4 as B,a5 as b,a6 as $,U as I,a7 as C,C as M}from"./BJj5iVno.js";import{u as ee}from"./CZeNUcEN.js";import{u as te}from"./C0of1JiW.js";import ae from"./xeNpmpzx.js";const se={class:"course-details-container"},oe={key:0,class:"course-details"},re={class:"course-details-subtitle"},le={class:"course-details-subtitle-right"},ie={class:"course-info-first"},ne={class:"course-info-item"},ce={style:{flex:"1",display:"flex","flex-direction":"column"}},ue={style:{color:"var(--p-surface-500)","font-size":"12px"}},de={style:{"font-size":"1.25rem"}},pe={style:{flex:"1",display:"flex","flex-direction":"column"}},me={style:{color:"var(--p-surface-500)","font-size":"12px"}},fe={style:{"font-size":"1.25rem"}},ve={key:0,class:"course-info-item"},_e={style:{"font-size":"1.1rem"}},ye={key:1,class:"course-info-item"},he={style:{"font-size":"1.1rem"}},ge={key:2,class:"course-info-item"},xe={style:{display:"flex",flexDirection:"row",gap:"clamp(0.5rem, 3vw - 0.5rem, 2rem)"}},we={style:{minWidth:"20%"}},be={style:{fontSize:"clamp(1rem, 2vw + 0.25rem, 1.2rem)",marginBottom:"0.5rem"}},$e={class:"course-info-item",style:{fontSize:"1.2rem",fontFamily:"sans-serif",alignItems:"flex-end",gap:"0.2rem"}},Ce={key:0,style:{fontSize:"1.75rem",fontWeight:"900"}},ke={key:1},ze={key:0,class:"course-info-item",style:{"flex-direction":"column","align-items":"flex-start"}},Se=["innerHTML"],De=["src","width","height"],Me={key:1,class:"course-details"},Ne={__name:"course",setup(Ge){const y=J(),{tempDatas:v,initTermData:A,courseFormatter:N,tsvToJson:L}=ee(),{windowWidth:m,selectCourseWithTerm:W,checkSelectedCourse:G,selectCodeHandler:E,checkSelectCode:U}=te(),t=x({year:y.query.year,term:y.query.term,serial_no:y.query.id}),k=x(!1),h=x(!1),g=x([]),H={必:"必修",選:"選修",通:"通識"},O={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};t.value.year&&t.value.term&&t.value.serial_no?q():console.error("Missing course parameters",{year:t.value.year,term:t.value.term,serial_no:t.value.serial_no});function q(){const a=V("rowDatas",()=>({})),s=`${t.value.year}-${t.value.term}`;function r(){Y({title:`${s} ${t.value.course_name}`}),setTimeout(()=>{F(t.value.course_code).then(l=>{t.value.description=l,Z({meta:[{name:"description",content:l?l.brief||l.description:""}]})})})}if(a.value[s]){for(const l of a.value[s])if(l.serial_no===t.value.serial_no){t.value={...l,description:null},g.value=z(t.value),r();return}}if(v.value[s]&&v.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]){for(const l of v.value[s][Math.floor(t.value.serial_no/1e3)+1])if(l.serial_no===t.value.serial_no){t.value={...N(l),description:null},g.value=z(t.value),r();return}}const i=Math.floor(t.value.serial_no/1e3)%10;fetch(`data/${s}/${i}.tsv`).then(l=>l.text()).then(async l=>{l=await L(l),v.value[s]=v.value[s]||{},v.value[s][i]=l;for(const T of l)if(T.serial_no===t.value.serial_no){t.value={...N(T),description:null},g.value=z(t.value),r();return}console.error("Course not found in fetched data")}).catch(l=>{console.error("Error fetching course data:",l)})}async function F(a){return await fetch("https://cors.ntnux.org/?course_code="+a).then(async r=>{const i=await r.json();return i&&i.data&&i.data.length>0?{description:i.data[0].CourseDescription||"",brief:i.data[0].brief||""}:(console.error("Description not found in response",i),"No description available.")}).catch(r=>(console.error("Error fetching course description:",r),"Error fetching description."))}function z(a){return[{label:"開課序號",icon:"pi pi-hashtag",value:a.serial_no},{label:"科目代碼",icon:"pi pi-code",value:a.course_code},{label:"開課單位",icon:"pi pi-building",value:a.dept_chiabbr},{icon:"pi pi-objects-column",value:H[a.option_code]||a.option_code,childen:typeof a.generalCore=="string"&&a.generalCore?a.generalCore.split("/").map(s=>O[s]||s):[]},{icon:"pi pi-graduation-cap",value:`${a.credit} 學分`,isNullValue:!a.credit},{label:"授課教師",icon:"pi pi-user",value:a.teacher||"無",isNullValue:!a.teacher},{label:"上課時間",icon:"pi pi-clock",value:a.time||"無",isNullValue:!a.time},{label:"上課地點",icon:"pi pi-map-marker",value:a.location||"無",isNullValue:!a.location},{icon:"pi pi-language",value:a.eng_teach==="是"?"英文授課":a.comment.match(/◎*語\s*授課/)?"國家語言授課":"中文授課"},{label:typeof a.programs=="string"&&a.programs.split("/").length>1?"學分學程":"",icon:"pi pi-book",value:typeof a.programs!="string"||a.programs===""?"無學分學程":a.programs.split("/").length>1?`${a.programs.split("/").length} 個學分學程`:a.programs,isNullValue:typeof a.programs!="string"||a.programs==="",childen:typeof a.programs=="string"&&a.programs.split("/").length>1?a.programs.split("/"):[]}]}function R(){h.value=!0,setTimeout(()=>{h.value=!1,k.value=!0},500)}return K(async()=>{const a=V("updateMenubar");await A(y),a.value()}),(a,s)=>(c(),u("div",se,[e(t).course_name?(c(),u("div",oe,[n(e(w),{label:"返回搜尋",icon:"pi pi-angle-left",severity:"secondary",variant:"text",onClick:s[0]||(s[0]=r=>a.$router.push("/")),style:{"padding-left":"0","padding-right":"0"}}),o("h1",null,p(e(t).course_name),1),o("div",re,[o("p",null,p(e(t).acadm_year)+"-"+p(e(t).acadm_term)+" 開課",1),o("div",le,[n(e(w),{icon:e(U)(e(t).course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(U)(e(t).course_code)?"danger":"secondary",variant:"text",onClick:s[1]||(s[1]=r=>e(E)(e(t).course_code,e(t).course_name)),rounded:""},null,8,["icon","severity"]),n(e(w),{label:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"取消":"加入",severity:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"warn":"secondary",onClick:s[2]||(s[2]=r=>e(W)(e(t),`${e(t).acadm_year}-${e(t).acadm_term}`))},null,8,["label","severity"])])]),n(e(ae),{class:"course-card"},{content:d(()=>[o("div",ie,[(c(!0),u(S,null,D(e(g),r=>(c(),u("div",{key:r.label},[r.childen&&r.childen.length>0?(c(),u("div",{key:0,class:"course-info-item",style:_({color:r.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[n(e(B),{value:"1",style:{width:"100%"}},{default:d(()=>[n(e(b),{value:"1",style:{width:"100%",border:"0"}},{default:d(()=>[n(e($),{style:{padding:"0",width:"100%"}},{default:d(()=>[o("div",ne,[o("i",{class:I(r.icon),style:{"font-size":"1.2rem"}},null,2),o("div",ce,[o("span",ue,p(r.label),1),o("span",de,p(r.value||""),1)])])]),_:2},1024),n(e(C),{style:{"--p-accordion-content-padding":"0 1.25rem"}},{default:d(()=>[(c(!0),u(S,null,D(r.childen,i=>(c(),u("div",{key:i,style:{margin:"0.5rem 0",fontSize:"1.1rem"}},[o("span",null,p(i),1)]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)],4)):(c(),u("div",{key:1,class:"course-info-item",style:_({color:r.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[o("i",{class:I(r.icon),style:{"font-size":"1.2rem"}},null,2),o("div",pe,[o("span",me,p(r.label),1),o("span",fe,p(r.value||""),1)])],4))]))),128))]),o("div",{class:"course-info-second",style:_(e(m)<600?{"--p-accordion-content-padding":"0 0 1.125rem 0"}:{})},[n(e(B),{multiple:"",value:["1","2","3"]},{default:d(()=>[n(e(b),{value:"1"},{default:d(()=>[n(e($),{style:{fontSize:"1.25rem"}},{default:d(()=>s[3]||(s[3]=[M(" 備註/限修 ")])),_:1}),n(e(C),null,{default:d(()=>[e(t).comment?(c(),u("div",ve,[s[4]||(s[4]=o("i",{class:"pi pi-comment",style:{"font-size":"1.2rem"}},null,-1)),o("span",_e,p(e(t).comment),1)])):f("",!0),e(t).restrict?(c(),u("div",ye,[s[5]||(s[5]=o("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"1.2rem"}},null,-1)),o("span",he,p(e(t).restrict),1)])):f("",!0),!e(t).comment&&!e(t).restrict?(c(),u("div",ge,s[6]||(s[6]=[o("span",{style:{"font-size":"1.1rem",color:"var(--p-surface-500)"}},"無",-1)]))):f("",!0)]),_:1})]),_:1}),n(e(b),{value:"2"},{default:d(()=>[n(e($),{style:{fontSize:"1.25rem"}},{default:d(()=>s[7]||(s[7]=[M(" 選課資訊 ")])),_:1}),n(e(C),null,{default:d(()=>[o("div",xe,[(c(!0),u(S,null,D([["選課總人數",e(t).counter_exceptAuth,e(t).limit_count_h],["已使用授權碼",Math.max(0,e(t).counter-e(t).counter_exceptAuth),e(t).authorize_p],["系統各校開放名額",null,e(t).limit]],([r,i,l])=>(c(),u("div",we,[o("div",be,[o("span",null,p(r),1)]),o("div",$e,[i!==null?(c(),u("div",Ce,p(i),1)):f("",!0),i!==null?(c(),u("div",ke,"/")):f("",!0),o("div",{style:_({fontSize:i!==null?"1.2rem":"1.75rem",fontWeight:i!==null?"400":"900"})},p(l),5)])]))),256))])]),_:1})]),_:1}),n(e(b),{value:"3"},{default:d(()=>[n(e($),{style:{fontSize:"1.25rem"}},{default:d(()=>s[8]||(s[8]=[M(" 課程簡介 ")])),_:1}),n(e(C),null,{default:d(()=>[e(t).description?(c(),u("div",ze,[o("span",{innerHTML:e(t).description.brief||e(t).description.description,style:{"font-size":"1.1rem","white-space":"pre-wrap","text-indent":"2em"}},null,8,Se)])):f("",!0)]),_:1})]),_:1})]),_:1})],4)]),_:1}),!e(k)||e(h)?(c(),P(e(w),{key:0,label:"顯示課程大綱",icon:"pi pi-file",severity:"contrast",variant:"outlined",onClick:R,loading:e(h),style:{marginTop:"20px",width:"100%"}},null,8,["loading"])):f("",!0),Q(o("div",{style:_({height:e(m)<950?(e(m)-10)/950*2e3+"px":"800px",overflow:"hidden",maxWidth:"95vw"})},[o("iframe",{src:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${e(t).acadm_year}&term=${e(t).acadm_term}&courseCode=${e(t).course_code}&courseGroup=${e(t).course_group}&deptCode=${e(t).dept_code}&formS=${e(t).form_s}&classes1=${e(t).classes}&deptGroup=${e(t).dept_group_name}`,width:e(m)<950?"950px":"100%",height:e(m)<950?"2000px":"800px",frameborder:"0",style:_({marginTop:"20px",background:"#fff","-webkit-transform":`scale(${e(m)<950?(e(m)-10)/950:1})`,"-moz-transform":`scale(${e(m)<950?(e(m)-10)/950:1})`,transformOrigin:"top left",marginLeft:"auto",marginRight:"auto"})},null,12,De)],4),[[X,e(k)]])])):(c(),u("div",Me,s[9]||(s[9]=[o("h2",null,"Loading course details...",-1)])))]))}},Ie=j(Ne,[["__scopeId","data-v-80ee0820"]]);export{Ie as default};
