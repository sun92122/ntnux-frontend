import{D as i}from"./BJj5iVno.js";function U(){const a=i("terms",()=>[]),t=i("currentTerm",()=>null),n=i("loadTermData"),o=i("rowDatas",()=>({})),c=i("rowData",()=>[]),l=i("tempDatas",()=>({})),u=i("loading",()=>!0),f=i("programSet",()=>new Set),p=i("lastUpdate",()=>({})),v=i("currentLastUpdate",()=>"unknown"),A=["course_name","teacher","serial_no"],F=async r=>{const e=await fetch(`data/${t.value}/${r}.tsv`);if(!e.ok)return null;const s=await e.text(),g=S(s);return g.length===0?null:h(g)},$=async()=>{var e;const r=[];for(let s=0;s<=10;s++)(e=l.value[t.value])!=null&&e[s]?r.push(Promise.resolve(h(l.value[t.value][s]))):r.push(F(s));for await(const s of r)s&&(c.value=c.value.concat(s),u.value=!1)},m=async()=>{if(u.value=!0,o.value[t.value]){c.value=o.value[t.value],p.value[t.value]||await d(),v.value=p.value[t.value]||"unknown",u.value=!1;return}c.value=[],await $(),o.value[t.value]=c.value,await d(),v.value=p.value[t.value]||"unknown"},k=async r=>{if(a.value.length>0){u.value=!1;return}const s=await(await fetch("/data/terms.json")).json();a.value=s.terms,t.value=r==null?void 0:r.query.term,(!t.value||a.value.indexOf(t.value)===-1)&&(t.value=s.defaultValue),n.value=m,await m()},d=async()=>{const r=await fetch(`/data/${t.value}/last_update.json`);if(!r.ok)return null;const e=await r.json();p.value[t.value]=e.last_update},x=r=>{const e=y(r.time_inf),s=j(e);return{...r,credit:Math.round(r.credit*10)/10,course_name:r.chn_name.replace(/<\/br>.*/g,""),time_loc:e,time:_(e),location:D(e),timeLocList:s,teacher:w(r.teacher),timeListStr:L(s),programs:T(r.chn_name)}},h=r=>(r.forEach(e=>{e.credit=Math.round(e.credit*10)/10,e.course_name=e.chn_name.replace(/<\/br>.*/g,""),e.time_loc=y(e.time_inf),e.time=_(e.time_loc),e.location=D(e.time_loc),e.timeLocList=j(e.time_loc),e.teacher=w(e.teacher),e.timeListStr=L(e.timeLocList),e.programs=T(e.chn_name),e.programs&&e.programs.split("/").forEach(s=>{f.value.add(s)})}),r);return{terms:a,currentTerm:t,rowData:c,tempDatas:l,loading:u,programSet:f,currentLastUpdate:v,reloadCurrentTerm:m,defaultGlobalFilterFields:A,initTermData:k,courseFormatter:x,tsvToJson:S}}function w(a){return a.replace("","温")}function _(a){return typeof a=="string"?a:Object.entries(a).map(([t,n])=>t).join("/")}function D(a){if(typeof a=="string")return null;const t=Object.values(a).filter(o=>o!==""),n=[...new Set(t)];return n.length===1?n[0]:t.join("/")}function y(a){return!a||a.startsWith("◎")?a:a.split(",").reduce((t,n)=>{const[o,c,...l]=n.trim().split(" ");return o&&c&&(t[`${o} ${c}`]=l.join(" ")),t},{})}function j(a){const t=[];if(typeof a!="object"||!a)return t;for(const n of Object.keys(a)){const o=n.match(/([一二三四五六])\s*(\d+|A|B|C|D)(?:-(\d+|A|B|C|D))?/);if(o){const[c,l,u,f]=o,p=b(u,f||u);for(const v of p)t.push({day:l,period:v,loc:a[n]})}}return t}function b(a,t){const n=["0","1","2","3","4","5","6","7","8","9","10","A","B","C","D"],o=n.indexOf(a),c=n.indexOf(t);return n.slice(o,c+1)}function L(a){return!Array.isArray(a)||a.length===0?"◎":a.map(({day:t,period:n})=>`${t}${n.replace("10","X")}`).join("/")}function T(a){const t=a.match(/.*\[ 學分學程：(.+?) \].*/);if(!t)return"";const n=t[1].split(" ");return n.length>0?n.join("/"):""}function S(a){const t=a.trim().split(`
`);if(t.length===0)return[];const n=t[0].trim().split("	");return t.slice(1).map(o=>{const c=o.trim().split("	"),l={};return n.forEach((u,f)=>{l[u]=c[f]??""}),l})}export{U as u};
