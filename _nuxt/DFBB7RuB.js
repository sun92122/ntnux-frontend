import{u as x,T as j,D as v,P as r,Q as p,r as A,I as D,o as E,F as K,v as S,x as m,y,A as h,B as g,H as l,U as R,M as $,N as H,G as C,V as W,C as J,z as P,W as X,J as I,X as Y,Y as Z,Z as V,$ as B,a0 as Q}from"./BJj5iVno.js";import{u as ee}from"./CZeNUcEN.js";import{u as le}from"./C0of1JiW.js";import ae from"./DZPj5ay0.js";import te from"./TJr1GkMb.js";import ue from"./CR4VZM3-.js";import se from"./YDtsCE2J.js";import oe from"./DYHpv7mV.js";const ie={class:"tabs-container"},re={class:"search-container search-bar"},ne={key:0,class:"global-filter-label",for:"globalFilter"},ce={key:1,class:"global-filter-label advanced-search-label",for:"globalFilter"},de={key:0,class:"search-input multi-search-input-sub-filter"},ve={key:1,class:"search-input multi-search-input-sub-filter"},ye={__name:"CourseSearchBar",props:{isSearchPage:{type:Boolean,default:!1},resetPage:{type:Function,default:null}},setup(d){const k=x(),b=j(),{programSet:F}=ee();le(),v("updateMenubar");const T=v("deptList",()=>[]);v("isShowSchedule",()=>!1);const N=v("isShowAdvancedSearch",()=>!1),q=v("subFilterRef",()=>null);v("scrollTableRef",()=>null);const s=v("filters",()=>({global:{value:null,matchMode:r.CONTAINS},...Object.fromEntries(["option_code","course_name","chn_name","dept_chiabbr","eng_teach","generalCore","dept_code","time_inf","time_loc","timeListStr","comment","credit","programs"].map(t=>[t,{operator:p.OR,constraints:[]}]))})),G=v("advancedSearchDisplayValue",()=>"點擊進行進階搜尋"),O=v("advancedSearchRebuildFunction"),u=A(""),o=A({value:null,filter_field:null,select_list:null,grouped_select_list:null,label:null}),f=A({quick:{label:"快速搜尋",value:"quick",route:"/?m=quick",command:()=>c({})},dept:{label:"系所",activeLabel:"開課系所",value:"dept",route:"/?m=dept",command:()=>c({dept_chiabbr:{operator:p.OR,constraints:[{value:null,matchMode:r.CONTAINS}]}},{label:"選擇開課單位",grouped_select_list:T.value||{},filter_field:"dept_code"})},advanced:{label:"進階搜尋",value:"advanced",route:"/?m=advanced",command:()=>{N.value=!0,c({}),s.value.global.value=null,O&&O.value&&O.value()}},general:{label:"通識",value:"general",route:"/?m=general",command:()=>c({option_code:{operator:p.OR,constraints:[{value:"通",matchMode:r.EQUALS}]}},{label:"選擇通識領域",select_list:Object.entries({人文藝術:"A1UG",社會科學:"A2UG",自然科學:"A3UG",邏輯運算:"A4UG",學院共同課程:"B1UG",跨域專業探索課程:"B2UG",大學入門:"B3UG",專題探究:"C1UG",MOOCs:"C2UG"}).map(([t,e])=>({label:t,value:{value:e,matchMode:r.CONTAINS}})),filter_field:"generalCore"})},physical:{label:"體育",activeLabel:"普通體育",value:"physical",route:"/?m=physical",command:()=>c({dept_chiabbr:{operator:p.OR,constraints:[{value:"體育",matchMode:r.CONTAINS}]}})},defense:{label:"國防",activeLabel:"全民國防教育",value:"defense",route:"/?m=defense",command:()=>c({chn_name:{operator:p.OR,constraints:[{value:"全民國防",matchMode:r.CONTAINS}]}})},interschool:{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",route:"/?m=interschool",command:()=>c({dept_chiabbr:{operator:p.OR,constraints:[{value:"校際",matchMode:r.CONTAINS}]}},{label:"選擇開課學校",select_list:Object.entries({國立臺灣大學:"AA",國立臺灣科技大學:"AB"}).map(([t,e])=>({label:t,value:{value:e,matchMode:r.ENDS_WITH}})),filter_field:"dept_code"})},program:{label:"學分學程",value:"program",route:"/?m=program",command:()=>c({chn_name:{operator:p.OR,constraints:[{value:"學分學程",matchMode:r.CONTAINS}]}},{label:"選擇學分學程",select_list:[...F.value].sort().map(t=>({label:t,value:{value:t,matchMode:r.CONTAINS}})),filter_field:"programs"})},english:{label:"英文三",value:"english",route:"/?m=english",command:()=>c({course_name:{operator:p.OR,constraints:[{value:"英文（三）",matchMode:r.CONTAINS}]}})},emi:{label:"英文授課",value:"emi",route:"/?m=emi",command:()=>c({eng_teach:{operator:p.OR,constraints:[{value:"是",matchMode:r.EQUALS}]}})},"":{label:"",value:"quick",route:"/?m=quick",command:()=>c({})}});function c(t,e=null){var a,n,i;D({title:((a=f.value[u.value])==null?void 0:a.activeLabel)||((n=f.value[u.value])==null?void 0:n.label)||"",description:"更適合師大人的課程查詢系統，更快、更強、行動裝置友好。"});for(const _ in s.value)_!=="global"&&(_ in t?s.value[_]=t[_]:(i=s.value[_]).constraints&&(i.constraints=[]));e?o.value={...o.value,value:null,filter_field:e.filter_field,select_list:e.select_list||null,grouped_select_list:e.grouped_select_list||null,label:e.label}:(o.value.select_list=null,o.value.grouped_select_list=null)}function U(){N.value=!0}function w(){const t=o.value.value;if(!t||Object.keys(t).length===0){s.value[o.value.filter_field].constraints=[{value:null,matchMode:r.CONTAINS}];return}const e=o.value.grouped_select_list;s.value[o.value.filter_field].constraints=Object.entries(t).map(([a,n])=>{if(!n.checked)return{value:null,matchMode:r.CONTAINS};const i=a.split("-");return i.length===1?e[a].data:i.length===2?e[i[0]].children[i[1]].data:e[i[0]].children[i[1]].children[i[2]].data})}function L(){if(s.value.global.value){const t=v("routerLoading",()=>!1);t.value=!0,k.push(`/?s=${s.value.global.value}`),setTimeout(()=>{t.value=!1},1e3)}}function z({path:t=null,m:e=null,s:a=null}){var n,i;t||(t=b.path),e||(e=u.value||void 0),a||(a=((i=(n=s.value)==null?void 0:n.global)==null?void 0:i.value)||void 0),k.push({path:t,query:{...b.query,m:e,s:a}})}function M({path:t=null,m:e=null,s:a=null}){var n,i;t||(t=b.path),e||(e=u.value||void 0),a||(a=((i=(n=s.value)==null?void 0:n.global)==null?void 0:i.value)||void 0),k.replace({path:t,query:{...b.query,m:e,s:a}})}return E(()=>{var t;u.value=b.query.m||"quick",f.value[u.value]?(t=f.value[u.value])==null||t.command():u.value="quick",b.query.s?s.value.global.value=b.query.s:s.value.global.value=null}),K(()=>[b.query,T.value],([t,e])=>{var a;t.m&&(f.value[t.m]?(u.value=t.m,(a=f.value[t.m])==null||a.command()):u.value="quick"),t.s?s.value.global.value=t.s:s.value.global.value=null,u.value==="dept"&&e&&(o.value.grouped_select_list=e)},{immediate:!0}),(t,e)=>(m(),S($,null,[y("div",ie,[h(l(ue),{value:l(u),"onUpdate:value":e[0]||(e[0]=a=>X(u)?u.value=a:null),scrollable:""},{default:g(()=>[h(l(ae),{class:R(d.isSearchPage?"":"tab-disabled")},{default:g(()=>[(m(!0),S($,null,H(Object.values(l(f)),a=>(m(),C(l(te),{as:"a",key:a.value,value:a.value,class:R(d.isSearchPage&&a.label?"":"tab-disabled"),href:a.route||null,style:{"text-decoration":"none"},onClick:W(()=>{var n,i;(!d.isSearchPage||l(u)!=a.value)&&(u.value=a.value),l(f)[l(u)]&&((i=(n=l(f)[l(u)]).command)==null||i.call(n)),d.resetPage&&d.resetPage(),d.isSearchPage?z({m:l(u)}):M({path:"/",m:l(u),s:l(s).global.value||void 0})},["prevent"])},{default:g(()=>[J(P(l(u)==a.value&&a.activeLabel||a.label),1)]),_:2},1032,["value","class","href","onClick"]))),128))]),_:1},8,["class"])]),_:1},8,["value"])]),y("div",re,[h(l(se),{variant:"in",class:R(["search-input",l(o).select_list||l(o).grouped_select_list?"multi-search-input-main-filter":"single-search-input"]),onClick:e[7]||(e[7]=a=>l(N)?U():null)},{default:g(()=>[h(l(Y),null,{default:g(()=>[h(l(Z),null,{default:g(()=>e[12]||(e[12]=[y("i",{class:"pi pi-search"},null,-1)])),_:1}),d.isSearchPage&&l(u)!="advanced"?(m(),C(l(V),{key:0,id:"globalFilter",modelValue:l(s).global.value,"onUpdate:modelValue":e[1]||(e[1]=a=>l(s).global.value=a),autocapitalize:!1,size:"large",style:{width:"100%"},onBlur:e[2]||(e[2]=a=>M({s:l(s).global.value})),onKeyup:e[3]||(e[3]=B(a=>M({s:l(s).global.value}),["enter"]))},null,8,["modelValue"])):d.isSearchPage?(m(),C(l(V),{key:1,id:"globalFilter",value:"",readonly:"",autocapitalize:!1,size:"large",style:{width:"100%",cursor:"pointer"},onClick:U})):(m(),C(l(V),{key:2,id:"globalFilter",modelValue:l(s).global.value,"onUpdate:modelValue":e[4]||(e[4]=a=>l(s).global.value=a),autocapitalize:!1,size:"large",style:{width:"100%"},onBlur:e[5]||(e[5]=a=>L()),onKeyup:e[6]||(e[6]=B(a=>L(),["enter"]))},null,8,["modelValue"]))]),_:1}),l(u)!="advanced"?(m(),S("label",ne,"課程名稱/教師/開課序號")):(m(),S("label",ce,P(l(G)||"點擊進行進階搜尋"),1))]),_:1},8,["class"]),d.isSearchPage&&l(o).select_list?(m(),S("div",de,[h(l(oe),{ref_key:"subFilterRef",ref:q,id:"sub-filter",modelValue:l(o).value,"onUpdate:modelValue":e[8]||(e[8]=a=>l(o).value=a),options:l(o).select_list,optionLabel:"label",optionValue:"value",showClear:!0,showToggleAll:!1,filter:!0,placeholder:l(o).label,display:"chip",style:{width:"100%"},onChange:e[9]||(e[9]=a=>{l(s)[l(o).filter_field].constraints=a.value||[{value:null,matchMode:l(r).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):I("",!0),d.isSearchPage&&l(o).grouped_select_list?(m(),S("div",ve,[h(l(Q),{ref_key:"subFilterRef",ref:q,id:"sub-filter-grouped",modelValue:l(o).value,"onUpdate:modelValue":e[10]||(e[10]=a=>l(o).value=a),options:l(o).grouped_select_list,selectionMode:"checkbox",filter:"",filterMode:"strict",showClear:!0,placeholder:l(o).label,style:{width:"100%"},onChange:e[11]||(e[11]=a=>w())},{empty:g(()=>e[13]||(e[13]=[y("span",{class:"p-multiselect-empty-label"},"系所們還在路上",-1)])),_:1},8,["modelValue","options","placeholder"])])):I("",!0)])],64))}};export{ye as _};
