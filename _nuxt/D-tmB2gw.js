import{g as I,v as y,x as n,y as a,z as c,A as l,B as o,C as i,H as e,L as S,G as p,J as v,M as R,N as U,_ as q,D as d,r as A,o as z,e as J,E as K,O as Q,P as W,Q as Y,R as T,S as X}from"./BJj5iVno.js";import{u as Z}from"./CZeNUcEN.js";import{u as ee}from"./C0of1JiW.js";import u from"./CZqt62L9.js";import{_ as se}from"./DFBB7RuB.js";import te from"./iOufmYqC.js";import"./DZPj5ay0.js";import"./DL0saGXe.js";import"./TJr1GkMb.js";import"./CR4VZM3-.js";import"./YDtsCE2J.js";import"./DYHpv7mV.js";const re={class:"course-row"},oe={class:"course-cell course-code"},ae={class:"course-cell course-title"},ce={class:"course-name"},le={class:"message-group"},ie={class:"course-cell"},ne={class:"message-group"},ue={class:"course-cell course-comment"},de={key:0},me={key:1},fe={__name:"courseCell",props:{course:{type:Object,required:!0}},setup(s){const w={必:"必修",選:"選修",通:"通識"},h={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(x,b)=>{const k=I("router-link");return n(),y("div",re,[a("div",oe,[a("span",null,c(s.course.serial_no),1),a("span",null,c(s.course.course_code),1)]),a("div",ae,[a("span",ce,[l(e(S),{variant:"link",size:"large",asChild:""},{default:o(()=>[l(k,{to:{name:"course",query:{year:s.course.acadm_year,term:s.course.acadm_term,id:s.course.serial_no}}},{default:o(()=>[i(c(s.course.course_name),1)]),_:1},8,["to"])]),_:1})]),a("div",le,[l(e(u),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:o(()=>[i(c(s.course.dept_chiabbr),1)]),_:1}),l(e(u),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:o(()=>[i(c(s.course.teacher),1)]),_:1}),s.course.time?(n(),p(e(u),{key:0,icon:"pi pi-clock",severity:s.course.time.match(/.* (0|1)([-/\n\r]|$)/)?"warn":"secondary",class:"custom-message"},{default:o(()=>[i(c(s.course.time),1)]),_:1},8,["severity"])):v("",!0),s.course.location?(n(),p(e(u),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:o(()=>[i(c(s.course.location),1)]),_:1})):v("",!0)])]),a("div",ie,[a("div",ne,[l(e(u),{severity:"secondary",class:"custom-message"},{default:o(()=>[i(c(s.course.credit)+" 學分",1)]),_:1}),l(e(u),{severity:"secondary",class:"custom-message"},{default:o(()=>[i(c(w[s.course.option_code]||s.course.option_code),1)]),_:1}),s.course.generalCore?(n(!0),y(R,{key:0},U(s.course.generalCore.split("/"),m=>(n(),p(e(u),{key:m,icon:"pi pi-objects-column",severity:"secondary",class:"custom-message"},{default:o(()=>[i(c(h[m]||m),1)]),_:2},1024))),128)):v("",!0),s.course.programs?(n(!0),y(R,{key:1},U(s.course.programs.split("/"),m=>(n(),p(e(u),{key:m,icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:o(()=>[i(c(m),1)]),_:2},1024))),128)):v("",!0),l(e(u),{icon:"pi pi-users",severity:s.course.limit_count_h>0?"secondary":"warn",class:"custom-message"},{default:o(()=>[i(c(`${s.course.limit_count_h} 人`),1)]),_:1},8,["severity"]),s.course.eng_teach==="是"?(n(),p(e(u),{key:2,severity:"error",class:"custom-message"},{default:o(()=>b[0]||(b[0]=[i("英文授課")])),_:1})):v("",!0)])]),a("div",ue,[s.course.restrict?(n(),y("span",de,c(s.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):v("",!0),s.course.comment?(n(),y("span",me,c(s.course.comment.replace(/<\/br>/g,`
`)),1)):v("",!0)])])}}},ve={class:"container"},ye={class:"grid-container"},he={class:"datatable-header"},ge={class:"datatable-header-end"},pe={style:{display:"flex",gap:"0.5rem","flex-wrap":"wrap","justify-content":"center"}},be={__name:"index",setup(s){Q();const w=K(),{currentTerm:h,rowData:x,loading:b,currentLastUpdate:k,defaultGlobalFilterFields:m,initTermData:B}=Z(),{selectedCourses:C,selectedRows:L,selectCourse:O,checkSelectedCourse:$,selectCodeHandler:E,checkSelectCode:M}=ee(),H=d("updateMenubar");d("deptList");const F=d("isShowSchedule",()=>!1),N=d("isShowAdvancedSearch",()=>!1),G=d("subFilterRef",()=>null),g=d("scrollTableRef",()=>null);d("lastUpdate",()=>({})),d("advancedSearchDisplayValue",()=>"點擊進行進階搜尋"),A("unknown");const P=A(""),D=d("filters",()=>({global:{value:null,matchMode:W.CONTAINS},...Object.fromEntries(["option_code","course_name","chn_name","dept_chiabbr","eng_teach","generalCore","dept_code","time_inf","time_loc","timeListStr","comment","credit","programs"].map(f=>[f,{operator:Y.OR,constraints:[]}]))}));function _(f){var r;if(N.value||F.value||G.value&&G.value.overlayVisible)return 0;const t=(r=g.value)==null?void 0:r.$el.querySelector(".p-datatable-table-container");return t&&(t.scrollTop=Math.max(0,Math.min(t.scrollTop+f,t.scrollHeight-t.clientHeight)),t.scrollTop<t.scrollHeight-t.clientHeight&&t.scrollTop>0)?1:0}function V(){g.value&&g.value.d_first!==void 0&&(g.value.d_first=0)}return z(async()=>{const f=r=>{_(r.deltaY)&&r.preventDefault()},t=r=>{r.key==="Home"&&_(-1/0),r.key==="End"&&_(1/0)};window.addEventListener("wheel",f,{passive:!1}),window.addEventListener("keydown",t),J(()=>{window.removeEventListener("wheel",f),window.removeEventListener("keydown",t)}),await B(w),H.value(),C.value[h.value]||(C.value[h.value]={}),L.value=C.value[h.value]}),(f,t)=>(n(),y("div",ve,[l(e(se),{isSearchPage:!0,resetPage:V}),a("div",ye,[l(e(X),{ref_key:"scrollTableRef",ref:g,value:e(x),paginator:!0,filters:e(D),"global-filter-fields":P.value.filter_field||e(m),showGridlines:!1,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 22rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:e(b),style:{border:"1px solid var(--p-datatable-border-color)",borderRadius:"0.5rem"},onPage:t[0]||(t[0]=r=>_(-1/0))},{header:o(()=>[a("div",he,[t[1]||(t[1]=a("span",null,"課程資訊",-1)),a("div",ge,[a("span",null,"最後更新："+c(e(k)),1)])])]),loading:o(()=>[l(e(te),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:o(()=>t[2]||(t[2]=[a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-2"}),a("span",null,"沒有符合條件的課程")],-1)])),default:o(()=>[l(e(T),{sortable:!1},{body:o(({data:r})=>[l(e(fe),{course:r},null,8,["course"])]),_:1}),l(e(T),{headerStyle:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center"},bodyStyle:{textAlign:"center"},sortable:!1,style:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center",paddingRight:"1rem"},header:""},{body:o(({data:r})=>[a("div",pe,[l(e(S),{icon:e(M)(r.course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(M)(r.course_code)?"danger":"secondary",variant:"text",onClick:j=>e(E)(r.course_code,r.course_name),rounded:""},null,8,["icon","severity","onClick"]),l(e(S),{label:e($)(r.serial_no)?"取消":"加入",severity:e($)(r.serial_no)?"warn":"secondary",onClick:j=>e(O)(r)},null,8,["label","severity","onClick"])])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])]))}},Te=q(be,[["__scopeId","data-v-1c0edbe1"]]);export{Te as default};
